
@{
    ViewBag.Title = "SKU Target V/S Actual | CJ Web Portal";
}
@section extra_style {
    <link href="~/Content/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/3.3.3/css/fixedColumns.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.1.9/css/fixedHeader.bootstrap4.min.css">
}
@section breadcrumb{
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item" aria-current="page"><a href="/">Transcom Digital</a></li>
            <li class="breadcrumb-item" aria-current="page">@Html.ActionLink("SKU Target V/S Actual", ViewContext.RouteData.Values["Action"].ToString(), ViewContext.RouteData.Values["controller"].ToString())</li>
        </ol>
    </nav>
}
<div class="panel" style="margin: 10px auto;">
    <div class="panel-heading bg-gradient-primary">
        <a data-toggle="collapse" href="#collapse1" class="collapsed">
            <div class="panel-title" style="color:white">
                <i class="fa fa-search"></i> Filter
            </div>
        </a>
    </div>
    <div id="collapse1" class="panel-collapse collapse bg-white p-3 shadow m-0 p-0">
        <div class="form-row">
            <div class="col-md-3 mb-3">
                <label for="validationTooltip01">Year </label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="year" id="year" data-live-search="true">
                        <option value="All">All</option>
                        @{
                            if (ViewBag.year != null)
                            {
                                foreach (var year in ViewBag.year)
                                {
                                    <option value="@year.Id">@year.Text</option>
                                }
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip01">Month </label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="month" id="month" data-live-search="true"></select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip01">week </label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="week" id="week" data-live-search="true"></select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip03">PG</label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="pg" id="pg" data-live-search="true">
                        <option value="All">All</option>
                        @{
                            if (ViewBag.pg != null)
                            {
                                foreach (var pg in ViewBag.pg)
                                {
                                    <option value="@pg.Id">@pg.Text</option>
                                }
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip03">MAG</label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="mag" id="mag" data-live-search="true">
                    </select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip03">ASG</label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="asg" id="asg" data-live-search="true">
                    </select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip03">AG</label>
                <div class="input-group">
                    <select class="selectpicker w-100" name="ag" id="ag" data-live-search="true">
                    </select>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <label for="validationTooltip03" class="text-white">Z</label>
                <div class="input-group">
                    <button class="btn btn-primary" id="filter" type="submit"><i class="fa fa-search"></i> Search <i class="fas fa-spinner fa-pulse" id="loadingIcon"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <div class="row">
        <div class="col-12">
            <div class="card shadow mb-4">
                <!-- Card Body -->
                <div class="card-body">
                    <table id="dataTable" class="table table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>Product <br />Code </th>
                                <th>Product<br />Name </th>
                                <th>Target<br />Qty </th>
                                <th>Sales<br />Qty </th>
                                <th>Sales % </th>
                                <th>Showroom<br />Code </th>
                                <th>TYear </th>
                                <th>TMonth </th>
                                <th>Week<br />No </th>
                                <th>PG<br />Name </th>
                                <th>MAG<br />Name </th>
                                <th>ASG<br />NAme </th>
                                <th>AG<br />Name </th>
                                <th>Brand </th>

                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@section extra_script {
    <!-- Page level plugins -->
    <script src="~/Content/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Content/datatables/dataTables.bootstrap4.min.js"></script>
    <!-- Page level custom scripts -->
    <script src="~/Content/datatables/datatables-custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/3.3.3/js/dataTables.fixedColumns.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.1.9/js/dataTables.fixedHeader.min.js"></script>
    <script>
        function loadtable() {
            var pg = $('#pg option:selected').text();
            var mag = $('#mag option:selected').text();
            var asg = $('#asg option:selected').text();
            var ag = $('#ag option:selected').text();
            var year = $('#year option:selected').text();
            var month = $('#month option:selected').text();
            var week = $('#week option:selected').text();
            var brand = $('#brand option:selected').text();
            if ($.fn.dataTable.isDataTable('#dataTable')) {
                table.destroy();
            }
            table = $('#dataTable').DataTable({
                "scrollX": true,
                "responsive": false,
                "pagingType": "full_numbers",
                "pageLength": 10,
                scrollCollapse: true,
                 fixedColumns:true,
                "language": {
                    paginate: {
                        next: '<i class="fa fa-fw fa-chevron-right">',
                        previous: '<i class="fa fa-fw fa-chevron-left">',
                        first: '<i class="fa fa-angle-double-left"></i>',
                        last: '<i class="fa fa-angle-double-right"></i>'
                    },
                },
                "initComplete": function (settings, json) {
                    closeloadermodal();
                    $("#loadingIcon").addClass("d-none");
                },
                "ajax": {
                    "url": "@Url.Action("loadSKUdata")",
                    "type": "GET",
                    "data": { pg: pg, mag: mag, asg: asg, ag: ag, year: year, month: month, brand: brand, week: week },
                    "datatype": "json",
                },
                "columns": [
                      { "data": "ProductCode" },
                      { "data": "ProductName" },
                      { "data": "TargetQty" },
                      { "data": "SalesQty" },
                      { "data": null },
                      { "data": "ShowroomCode"},
                      { "data": "TYear"},
                      { "data": "TMonth"},
                      { "data": "WeekNo"},
                      { "data": "PGName"},
                      { "data": "MAGName"},
                      { "data": "ASGNAme"},
                      { "data": "AGName"},
                      { "data": "Branddesc"},
                      
                ],
            "columnDefs": [
                {
                    "targets": 4,
                    "render": function (data, type, row, meta) {
                        return ((row.SalesQty / row.TargetQty) * 100).toFixed(0) +"%";
                    }
                }]
            });
        };
        $(function () {
            $('select').selectpicker();
            //loadermodal();
            //loadtable();
            //$('#dataTable').DataTable();
            $("#loadingIcon").addClass("d-none");
            $('.datepicker').datepicker();
            $("#filter").click(function () {
                $("#loadingIcon").removeClass("d-none");
                loadermodal();
                loadtable();
            });
        });
    </script>
    <!-- Bootstrap DatePicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.css" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js" type="text/javascript"></script>
    <!-- Bootstrap DatePicker -->
    <script type="text/javascript">
        $(function () {
            $('.datepicker').datepicker({
                changeMonth: true,
                changeYear: true,
                format: "M/DD/YYYY",
            });
        });
        function loadmag() {
            $("#mag").find('option').remove();
            $('#mag').selectpicker('refresh');
            var pg = $('#pg option:selected').val();
            $.ajax({
                type: "GET",
                url: '@Url.Action("loadmag", "Common")',
                data: { pg: pg },
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $("#asg").find('option').remove();
                    $('#asg').selectpicker('refresh');
                    $("#ag").find('option').remove();
                    $('#ag').selectpicker('refresh');
                    $('#mag').append($('<option>', {
                        value: 'All',
                        text: 'All'
                    }));
                    $('#mag').selectpicker('refresh');
                    for (var i = 0; i < data.length; i++) {
                        $('#mag').append($('<option>', {
                            value: data[i].Id,
                            text: data[i].Text
                        }));
                        $('#mag').selectpicker('refresh');
                    }
                },
                error: function () {
                    alert("Error while inserting data");
                }
            });
        }

        function loadasg() {
            $("#asg").find('option').remove();
            $('#asg').selectpicker('refresh');
            var mag = $('#mag option:selected').val();
            $.ajax({
                type: "GET",
                url: '@Url.Action("loadasg", "Common")',
                data: { mag: mag },
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $("#ag").find('option').remove();
                    $('#ag').selectpicker('refresh');
                    $('#asg').append($('<option>', {
                        value: 'All',
                        text: 'All'
                    }));
                    $('#asg').selectpicker('refresh');
                    for (var i = 0; i < data.length; i++) {
                        $('#asg').append($('<option>', {
                            value: data[i].Id,
                            text: data[i].Text
                        }));
                        $('#asg').selectpicker('refresh');
                    }
                },
                error: function () {
                    alert("Error while inserting data");
                }
            });
        }
        function loadag() {
            $("#ag").find('option').remove();
            $('#ag').selectpicker('refresh');
            var asg = $('#asg option:selected').val();
            $.ajax({
                type: "GET",
                url: '@Url.Action("loadag", "Common")',
                data: { asg: asg },
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $('#ag').append($('<option>', {
                        value: 'All',
                        text: 'All'
                    }));
                    $('#ag').selectpicker('refresh');
                    for (var i = 0; i < data.length; i++) {
                        $('#ag').append($('<option>', {
                            value: data[i].Id,
                            text: data[i].Text
                        }));
                        $('#ag').selectpicker('refresh');
                    }
                },
                error: function () {
                    alert("Error while inserting data");
                }
            });
        }
         $("#pg").change(function () {
                loadmag();
                return false;
            });
         $("#mag").change(function () {
             loadasg();
             return false;
         });
         $("#asg").change(function () {
             loadag();
             return false;
         });


         //Area dropdown init
         $("#year").change(function () {
             var valueSelected = this.value;
             $.ajax({
                 type: "GET",
                 url: '@Url.Action("loadMonth", "Common")',
                 data: { year: valueSelected },
                 dataType: "json",
                 contentType: "application/json; charset=utf-8",
                 success: function (data) {
                     $("#month").find('option').remove();
                     $('#month').selectpicker('refresh');
                     $("#week").find('option').remove();
                     $('#week').selectpicker('refresh');
                     $('#month').append($('<option>', {
                         value: '',
                         text: 'All'
                     }));
                     $('#month').selectpicker('refresh');
                     for (var i = 0; i < data.length; i++) {
                         //s += '<option value="' + data[i].MarketGroupCode + '">' + data[i].MarketGroupDesc + '</option>';
                         $('#month').append($('<option>', {
                             value: data[i].Id,
                             text: data[i].Text
                         }));
                         $('#month').selectpicker('refresh');
                     }

                 },
                 error: function () {
                     alert("Error while inserting data");
                 }
             });
             return false;
         });

         //Customer dropdown init
         $("#month").change(function () {
             var valueSelected = this.value;
             var valueyear = $("#year").val();
             $.ajax({
                 type: "GET",
                 url: '@Url.Action("loadweek", "Common")',
                 data: { month: valueSelected, year: valueyear },
                 dataType: "json",
                 contentType: "application/json; charset=utf-8",
                 success: function (data) {

                     $("#week").find('option').remove();
                     $('#week').selectpicker('refresh');
                     $('#week').append($('<option>', {
                         value: '',
                         text: 'All'
                     }));
                     $('#week').selectpicker('refresh');
                     for (var i = 0; i < data.length; i++) {
                         $('#week').append($('<option>', {
                             value: data[i].Id,
                             text: data[i].Text
                         }));
                         $('#week').selectpicker('refresh');
                     }
                 },
                 error: function () {
                     alert("Error while inserting data");
                 }
             });
             return false;
         });
</script>
}




